name: Deploy Hugo site to GitHub Pages

on:
  push:
    branches:
      - master  # 触发工作流的分支是 master
  workflow_dispatch:  # 允许手动触发工作流

permissions:
  contents: read  # 读取仓库内容
  pages: write    # 写入 GitHub Pages
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false  # 允许多个任务并行运行，但不取消当前进行中的任务

jobs:
  build:
    runs-on: ubuntu-latest  # 使用 Ubuntu 最新版本的环境

    steps:
      # 检出仓库代码
      - name: Checkout code
        uses: actions/checkout@v4

      # 设置 Hugo 环境
      - name: Set up Hugo
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: '0.128.0'  # 你可以根据需要更改 Hugo 版本

      # 构建 Hugo 网站
      - name: Build the Hugo site
        run: hugo --minify  # 生成静态文件并进行最小化处理

      # 上传构建的静态文件到 GitHub Pages
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./public  # Hugo 构建的文件会被输出到 `public` 目录

  deploy:
    runs-on: ubuntu-latest
    needs: build  # 依赖于 build 作业，确保先构建后部署
    steps:
      # 将构建的静态文件部署到 GitHub Pages
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
        with:
          branch: gh-pages  # 将构建的文件推送到 `gh-pages` 分支
          folder: ./public  # Hugo 输出的静态文件目录
